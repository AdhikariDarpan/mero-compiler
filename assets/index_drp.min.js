 const container=document.getElementById('resizableGrid');const dragBar=document.getElementById('dragBar');let isDragging=false;dragBar.addEventListener('mousedown',function(e){isDragging=true;document.body.style.cursor='col-resize';});window.addEventListener('mouseup',function(){isDragging=false;document.body.style.cursor='';});window.addEventListener('mousemove',function(e){if(!isDragging)return;const containerRect=container.getBoundingClientRect();const totalWidth=containerRect.width;let offsetX=e.clientX-containerRect.left;offsetX=Math.max(100,Math.min(offsetX,totalWidth-100));const leftWidth=(offsetX / totalWidth)* 100;const rightWidth=100-leftWidth;container.style.gridTemplateColumns=`${leftWidth}% 5px ${rightWidth}%`;});const iframe=document.getElementById('editor');const doc=iframe.contentDocument||iframe.contentWindow.document;doc.open();doc.write('<html><body><div id="editor-field" style="height:100%;outline:none;border:none;" contenteditable="true"></div></body></html>');doc.close();const htmlCode=document.getElementById("htmlCode");const cssCode=document.getElementById("cssCode");const jsCode=document.getElementById("jsCode");htmlCode.addEventListener('paste',(e)=>{const selection=window.getSelection();const selectedText=selection.toString();if(selectedText.length===htmlCode.value.length && htmlCode.value.length>0){e.preventDefault();const pastedText=(e.clipboardData||window.clipboardData).getData('text');extract_html_code(pastedText);}});function extract_html_code(html){const tempDiv=document.createElement('html');tempDiv.innerHTML=html;let titleText='';let headContent='';let bodyContent='';let cssContent='';let jsContent='';let externalScripts='';tempDiv.querySelectorAll('style').forEach(style=>{cssContent+=formatCSS(style.textContent.trim())+'\n\n';style.remove();});tempDiv.querySelectorAll('script').forEach(script=>{if(script.hasAttribute('src')){externalScripts+=`<script src="${script.getAttribute('src')}"></script>\n`;}else{jsContent+=formatJS(script.textContent.trim())+'\n\n';}script.remove();});const title=tempDiv.querySelector('title');if(title){titleText=title.textContent.trim();title.remove();}const head=tempDiv.querySelector('head');if(head)headContent=formatNode(head,2).trim();const body=tempDiv.querySelector('body')||tempDiv;bodyContent=formatNode(body,2).trim();if(externalScripts.trim()){bodyContent+='\n'+externalScripts.trim();}if(bodyContent.length>1){const finalHTML=`<!DOCTYPE html><html><head><title>${titleText}</title>${headContent}</head><body>${bodyContent}</body></html>`;htmlCode.value=formatHTMLParse(finalHTML);cssCode.value=formatCSS(cssContent.trim());jsCode.value=formatJS(jsContent.trim());updateOutput();}}function formatHTMLParse(h){const p=new DOMParser();const d=p.parseFromString(h,"text/html");return formatNode(d.documentElement,0).trim();}function formatNode(n,l){const i=" ".repeat(l);let o="";const voidTags=['area','base','br','col','embed','hr','img','input','link','meta','source','track','wbr'];if(n.nodeType===1){const tagName=n.tagName.toLowerCase();const t="<"+tagName+[...n.attributes] .map((a)=>" "+a.name+'="'+a.value+'"').join("")+">";if(voidTags.includes(tagName)){o+=i+t+"\n";}else if(n.childNodes.length===0){o+=i+t+"</"+tagName+">\n";}else{o+=i+t+"\n";n.childNodes.forEach((ch)=>{o+=formatNode(ch,l+1);});o+=i+"</"+tagName+">\n";}}else if(n.nodeType===3){const txt=n.nodeValue.trim();if(txt)o+=i+txt+"\n";}else if(n.nodeType===8){o+=i+"<!--"+n.nodeValue+"-->\n";}return o;}function formatCSS(css){return css .split('}').map(rule=>rule.trim()).filter(Boolean).map(rule=>{const [selector,body]=rule.split('{');return `${selector.trim()}{\n ${body.trim().split(';').filter(Boolean).map(line=>line.trim()+';').join('\n ')}\n}`;}).join('\n\n');}function formatJS(js){return js .split(';').map(line=>line.trim()).filter(Boolean).map(line=>line+';').join('\n');}function resetIframe(){const oldFrame=document.getElementById("outputFrame");const newFrame=oldFrame.cloneNode(false);oldFrame.parentNode.replaceChild(newFrame,oldFrame);return newFrame;}cssCode.addEventListener('input',updateOutput);function updateOutput(){const rawHTML=document.getElementById("htmlCode").value;const css=document.getElementById("cssCode").value;const js=document.getElementById("jsCode").value;const titleMatch=rawHTML.match(/<title>([\s\S]*?)<\/title>/i);const title=titleMatch?titleMatch[1].trim():null;document.getElementById("outputTitle").textContent=title?title:"Untitled";const iframe=resetIframe();const iframeDoc=iframe.contentDocument||iframe.contentWindow.document;let html=rawHTML;let scriptMatches=[...html.matchAll(/<script\b([^>]*)>([\s\S]*?)<\/script>/gi)];let extractedScript='';let externalScripts='';scriptMatches.forEach(match=>{const attr=match[1];const content=match[2].trim();const srcMatch=attr.match(/src=["']([^"']+)["']/i);if(srcMatch){externalScripts+=`<script src="${srcMatch[1]}"><\/script>\n`;}else{extractedScript+=content+'\n';}});html=html.replace(/<script\b[^>]*>[\s\S]*?<\/script>/gi,"");document.getElementById("consoleOutput").innerHTML="";const output=`<!DOCTYPE html><html><head><style>${css}</style></head><body>${html}${externalScripts}<script>window.onerror=function(msg,url,line,col,error){parent.postMessage({type:"error",message:(error && error.stack)||(msg+" at line "+line+":"+col)},"*");};['log','error','warn','info'].forEach((type)=>{const original=console[type];console[type]=(...args)=>{parent.postMessage({type:type,message:args.map(a=>{try{return typeof a==='object'?JSON.stringify(a,null,2):String(a);}catch(e){return String(a);}}).join(' ')},"*");original.apply(console,args);};});try{${extractedScript.replace(/<\/script>/g,"<\\/script>")}${js.replace(/<\/script>/g,"<\\/script>")}}catch(e){parent.postMessage({type:"error",message:e.message},"*");}<\/script></body></html>`;iframeDoc.open();iframeDoc.write(output);iframeDoc.close();}const PreHtml=`<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /><title>Developer Darpan</title></head><body><div class="card"><a href="https://darpanadhikari.com.np"><img draggable="false" src="https://darpanadhikari.com.np/addition/images/darpan.png" class="avatar" /></a><div class="name">Darpan Adhikari</div><div class="role">Software Developer|Web • App • Python</div><button class="btn-toggle" onclick="toggleTheme()">Toggle Theme</button></div></body></html>`;const PreCss=`:root{--bg-light:#c3cfe2;--bg-dark:#1f1c2c;--bg-dark-secondary:#928dab;--text-light:#000;--text-dark:#fff;--text-muted:#555;--text-muted-dark:#ccc;--card-bg-light:rgba(255,255,255,0.1);--card-bg-dark:rgba(255,255,255,0.05);--btn-light-bg:#000;--btn-light-color:#fff;--btn-dark-bg:#fff;--btn-dark-color:#000;}*{margin:0;padding:0;box-sizing:border-box;}body{font-family:'Segoe UI',sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;background:linear-gradient(135deg,var(--bg-light),var(--bg-light));transition:background 0.3s;color:var(--text-light);}.card{background:var(--card-bg-light);backdrop-filter:blur(20px);border-radius:20px;padding:2rem;width:300px;text-align:center;box-shadow:0 0 30px rgba(0,0,0,0.1);color:var(--text-light);transition:0.3s;}.avatar{width:100px;height:100px;border-radius:50%;margin-bottom:1rem;object-fit:cover;}.name{font-size:1.4rem;font-weight:600;}.role{font-size:0.9rem;color:var(--text-muted);margin-bottom:1rem;}.btn-toggle{padding:0.6rem 1.2rem;border:none;border-radius:30px;background:var(--btn-light-bg);color:var(--btn-light-color);cursor:pointer;transition:0.3s;}.dark{background:linear-gradient(135deg,var(--bg-dark),var(--bg-dark-secondary));color:var(--text-dark);}.dark .card{background:var(--card-bg-dark);color:var(--text-dark);}.dark .role{color:var(--text-muted-dark);}.dark .btn-toggle{background:var(--btn-dark-bg);color:var(--btn-dark-color);}`;const PreJs=`function toggleTheme(){document.body.classList.toggle('dark');}console.info("This is console");`;document.getElementById("htmlCode").value=formatHTMLParse(PreHtml);document.getElementById("cssCode").value=formatCSS(PreCss);document.getElementById("jsCode").value=formatJS(PreJs);updateOutput();const tabButtons=document.querySelectorAll(".tab-button");const codeEditors=document.querySelectorAll(".code-editor");tabButtons.forEach((button)=>{button.addEventListener("click",()=>{tabButtons.forEach((btn)=>btn.classList.remove("active"));codeEditors.forEach((editor)=>editor.classList.remove("active"));button.classList.add("active");const tabName=button.getAttribute("data-tab");document.getElementById(`${tabName}Code`).classList.add("active");});});document.querySelectorAll("textarea").forEach((field)=>{field.addEventListener("input",()=>{const pos=field.selectionStart;const value=field.value;const char=value[pos-1];const pairs={'{':'}','(':')','[':']','"':'"',"'":"'"};const match=value.slice(0,pos).match(/<(\w+)>$/);if(match){const tag=match[1];const voidTags=['area','base','br','col','embed','hr','img','input','link','meta','source','track','wbr'];if(!voidTags.includes(tag)){const openTags=(value.match(new RegExp(`<${tag}(\\s[^>]*)?>`,"g"))||[]).length;const closeTags=(value.match(new RegExp(`</${tag}>`,"g"))||[]).length;if(openTags>closeTags){const before=value.slice(0,pos);const after=value.slice(pos);field.value=before+`</${tag}>`+after;field.selectionStart=field.selectionEnd=pos;if(field.id==="cssCode"){updateOutput();}return;}}}if(pairs[char] && field.selectionStart===field.selectionEnd){const closing=pairs[char];const before=value.slice(0,pos-1);const after=value.slice(pos);const nextChar=after[0];const shouldInsert=!nextChar||(nextChar!==closing &&!/\w/.test(nextChar));if(shouldInsert){field.value=before+char+closing+after;field.selectionStart=field.selectionEnd=pos;if(field.id==="cssCode"){updateOutput();}return;}}});});document.getElementById("compileBtn").addEventListener("click",()=>{document.getElementById("consoleOutput").innerHTML="";updateOutput();});const converter=document.getElementById("converter");converter.addEventListener("click",(e)=>{let popup=document.getElementById("popup");popup.style.display="block";doc.getElementById("editor-field").focus();});document.addEventListener("click",function(event){let popup=document.getElementById("popup");if(!popup.contains(event.target)&& event.target!==converter){popup.style.display="none";}});document.getElementById("finish").addEventListener("click",function(){const htmlContent=doc.getElementById("editor-field").innerHTML;popup.style.display="none";doc.getElementById("editor-field").innerHTML='';const bodyContent=new DOMParser().parseFromString(htmlContent,"text/html").body.innerHTML.trim();if(bodyContent){extractInlineStylesAndScripts(htmlContent);}});function extractInlineStylesAndScripts(htmlContent){const htmlInput=document.getElementById("htmlCode");const cssOutput=document.getElementById("cssCode");const jsOutput=document.getElementById("jsCode");let parser=new DOMParser();let doc=parser.parseFromString(htmlContent.trim(),"text/html");let cssContent="";let jsContent="";let elementCount=1;doc.querySelectorAll("[style]").forEach(element=>{let className=`drp_element_${elementCount}`;element.className=className;let formattedStyle=element.getAttribute("style").split(";").map(line=>line.trim()).filter(line=>line).map(line=>` ${line};`).join("\n");cssContent+=`.${className}{\n${formattedStyle}\n}\n\n`;element.removeAttribute("style");elementCount++;});doc.querySelectorAll("[onclick],[onmouseover],[onmouseout],[onchange],[oninput]").forEach(element=>{let className=`drp_element_${elementCount}`;element.classList.add(className);Array.from(element.attributes).forEach(attr=>{if(attr.name.startsWith("on")){let formattedJs=attr.value .split(";").map(line=>line.trim()).filter(line=>line).map(line=>` ${line};`).join("\n");jsContent+=`document.querySelector('.${className}').${attr.name}=function(){\n${formattedJs}\n};\n\n`;element.removeAttribute(attr.name);}});elementCount++;});function formatHTML(node,indent=2){let formattedHtml="";node.childNodes.forEach(child=>{if(child.nodeType===Node.ELEMENT_NODE){let tag=child.outerHTML.split(">")[0]+">";let closingTag=`</${child.tagName.toLowerCase()}>`;formattedHtml+=" ".repeat(indent)+tag+"\n";formattedHtml+=formatHTML(child,indent+2);formattedHtml+=" ".repeat(indent)+closingTag+"\n";}else if(child.nodeType===Node.TEXT_NODE && child.nodeValue.trim()){formattedHtml+=" ".repeat(indent)+child.nodeValue.trim()+"\n";}});return formattedHtml;}let formattedHtml=formatHTML(doc.body,2);let html=`<!DOCTYPE html>\n<html>\n<head>\n</head>\n<body>\n${formattedHtml}</body>\n</html>`;htmlInput.value=html;cssOutput.value=cssContent.trim();jsOutput.value=jsContent.trim();updateOutput();}async function downloadHTML(){const html=document.getElementById("htmlCode").value.trim();if(html==='')return;const css=document.getElementById("cssCode").value.trim();const js=document.getElementById("jsCode").value.trim();const parser=new DOMParser();const doc=parser.parseFromString(html,"text/html");let finalCSS=css;let finalJS=js;doc.querySelectorAll("style").forEach(style=>{finalCSS+="\n"+style.innerHTML;style.remove();});doc.querySelectorAll("script").forEach(script=>{if(!script.src){finalJS+="\n"+script.innerHTML;script.remove();}});let styleIndex=0;doc.querySelectorAll("*[style]").forEach(el=>{const styleContent=el.getAttribute("style");const className=`auto_drp_style_${styleIndex++}`;finalCSS+=`\n.${className}{${styleContent}}`;el.classList.add(className);el.removeAttribute("style");});const titleMatch=html.match(/<title>([\s\S]*?)<\/title>/i);const title=titleMatch?titleMatch[1].trim():null;const finalHTML=`<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>${title||"Untitled"}</title><link rel="stylesheet" href="assets/style.css"></head><body>${doc.body.innerHTML}<script src="assets/script.js"></script></body></html>`;const animatedConsoleJS=` const colors=["blue","purple","red","green","orange","grey","white","black"];let index=0;function animateConsoleLog(){console.clear();console.log("%chttps://darpanadhikari.com.np","font-size:40px;color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,0.4);"+"background:"+colors[index]+";padding:10px;");index=(index+1)% colors.length;setTimeout(animateConsoleLog,500);}animateConsoleLog();\n\n${finalJS}`;const zip=new JSZip();zip.file("index.html",finalHTML);zip.folder("assets").file("style.css",finalCSS);zip.folder("assets").file("script.js",animatedConsoleJS);const blob=await zip.generateAsync({type:"blob"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="drp__template.zip";document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);}document.addEventListener('keydown',function(event){if(event.ctrlKey && event.key==='s'){event.preventDefault();if(confirm("Do you want to download the file?")){document.getElementById('download').click();}}});const screenSize=document.getElementById('screen-size');screenSize.addEventListener('click',(e)=>{const container=document.querySelector('.container');container.classList.toggle('split');window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});});window.addEventListener("message",(event)=>{if(!event.data||!event.data.type||!event.data.message)return;const logContainer=document.getElementById("consoleOutput");const div=document.createElement("div");div.textContent=`[${event.data.type.toUpperCase()}] ${event.data.message}`;div.style.whiteSpace="pre-wrap";switch(event.data.type){case "error":div.style.color="red";break;case "warn":div.style.color="orange";break;case "info":div.style.color="cyan";break;default:div.style.color="lime";}logContainer.appendChild(div);document.getElementById("consoleContainer").scrollTop=document.getElementById("consoleContainer").scrollHeight;logContainer.scrollTop=logContainer.scrollHeight;updatePopupLogs();});let popupWindow=null;document.getElementById("popupConsole").addEventListener("click",()=>{if(popupWindow &&!popupWindow.closed){popupWindow.focus();return;}document.getElementById("consoleContainer").style.display="none";popupWindow=window.open("","_blank","width=600,height=400,scrollbars=yes");popupWindow.document.write(`<html><head><title>Console Output</title><style>body{background:black;color:white;font-family:monospace;white-space:pre-wrap;padding:10px;}div{margin-bottom:4px;}</style></head><body></body></html>`);popupWindow.document.close();updatePopupLogs();const checkClosed=setInterval(()=>{if(popupWindow.closed){clearInterval(checkClosed);document.getElementById("consoleContainer").style.display="block";document.getElementById("consoleContainer").scrollTop=document.getElementById("consoleContainer").scrollHeight;popupWindow=null;window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});}},500);});function updatePopupLogs(){if(popupWindow &&!popupWindow.closed){const logs=document.getElementById("consoleOutput").innerHTML;popupWindow.document.body.innerHTML=logs;popupWindow.scrollTo(0,popupWindow.document.body.scrollHeight);}}document.getElementById('htmlInput').addEventListener('change',function(e){const file=e.target.files[0];if(!file||!file.name.endsWith('.html'))return;const reader=new FileReader();reader.onload=()=>extract_html_code(reader.result);reader.readAsText(file);});document.getElementById("jsCssInput").addEventListener("change",function(e){const files=[...e.target.files];const cssFiles=files.filter(file=>file.name.endsWith('.css'));const jsFiles=files.filter(file=>file.name.endsWith('.js'));if(cssFiles.length){Promise.all(cssFiles.map(f=>f.text())).then(contents=>{const combinedCSS=contents.join('\n\n');let action=false;if(cssCode.value.trim().length!==0){action=confirm("Do you want to *append* the CSS to existing one?\nPress OK for Append,Cancel for Replace.");}if(action){cssCode.value+='\n'+combinedCSS;}else{cssCode.value=combinedCSS;}});}if(jsFiles.length){Promise.all(jsFiles.map(f=>f.text())).then(contents=>{const combinedJS=contents.join('\n\n');let action=false;if(jsCode.value.trim().length!==0){action=confirm("Do you want to *append* the JS to existing one?\nPress OK for Append,Cancel for Replace.\n(Note:Check your variable/function order)");}if(action){jsCode.value+='\n'+combinedJS;}else{jsCode.value=combinedJS;}});}});const popup=document.getElementById('drp-instruction-popup');const openBtn=document.getElementById('drp-instruction-open-btn');const closeBtn=popup.querySelector('.drp-instruction-close');const buttons=popup.querySelectorAll('.drp-instruction-btn');let oldUser=localStorage.getItem('user');if(!oldUser){popup.style.display='flex';}openBtn.addEventListener('click',()=>{popup.style.display='flex';});closeBtn.addEventListener('click',()=>{oldUser=localStorage.getItem('user');if(!oldUser){popup.classList.add('first-time');localStorage.setItem('user',true);setTimeout(()=>{popup.classList.remove('first-time');popup.style.display='none';},1000);}else{popup.style.display='none';}});buttons.forEach(btn=>{btn.addEventListener('click',()=>{buttons.forEach(b=>{if(b!==btn)b.nextElementSibling.style.display='none';});const content=btn.nextElementSibling;content.style.display=(content.style.display==='block')?'none':'block';});});